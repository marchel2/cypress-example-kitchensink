# run the same job on 2 CI machines in parallel
# https://docs.microsoft.com/en-us/vsts/pipelines/process/phases

pool:
  vmImage: 'Ubuntu 16.04'
  
steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '8.x'
    displayName: 'Install Node.js'

  - script: |
      apt-get update && apt-get install -y libgconf-2-4
    displayName: 'install dependencies'

  - script: |
      npm ci
    displayName: 'npm install and build'

  # always interesting to see build-related environment variables
  # https://docs.microsoft.com/en-us/vsts/pipelines/build/variables?view=vsts
  - script: |
      npm run print-env -- BUILD
    displayName: 'print environment variables'

  - script: |
      npm run cy:verify
    displayName: 'Cypress verify'

  - script: |
      npm run test:ci:record
    displayName: 'Run Cypress tests'
